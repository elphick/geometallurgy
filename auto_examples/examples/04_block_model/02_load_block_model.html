<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Load Block Model &mdash; geometallurgy  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=1a8b2067" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Mass Balance" href="../05_mass_balance/01_mass_balance.html" />
    <link rel="prev" title="Consuming OMF" href="01_consuming_omf.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            geometallurgy
          </a>
              <div class="version">
                0.4.13
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../scope/scope.html">Project Scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Example Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#interval-samples">Interval Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#flowsheets">Flowsheets</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#block-models">Block Models</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_consuming_omf.html">Consuming OMF</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Load Block Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#load">Load</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-blockmodel">Create a BlockModel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-the-block-model">Plot the block model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filter-the-data">Filter the data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#mass-balancing">Mass Balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#spatial">Spatial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../todo.html">To Do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license/license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">geometallurgy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Example Gallery</a></li>
      <li class="breadcrumb-item active">Load Block Model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/auto_examples/examples/04_block_model/02_load_block_model.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-examples-04-block-model-02-load-block-model-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="load-block-model">
<span id="sphx-glr-auto-examples-examples-04-block-model-02-load-block-model-py"></span><h1>Load Block Model<a class="headerlink" href="#load-block-model" title="Link to this heading"></a></h1>
<p>Demonstrates loading a block model in parquet format into pyvista.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">elphick.geomet</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sample</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">elphick.geomet.block_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">BlockModel</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
<section id="load">
<h2>Load<a class="headerlink" href="#load" title="Link to this heading"></a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">block_model_filepath</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;../../assets/copper_deposit.parquet&quot;</span><span class="p">)</span>

<span class="c1"># Load the parquet file into a DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">block_model_filepath</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(1689600, 1)
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>CU_pct</th>
    </tr>
    <tr>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>444705.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>0.002696</td>
    </tr>
    <tr>
      <th>444715.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>0.002760</td>
    </tr>
    <tr>
      <th>444725.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>0.002826</td>
    </tr>
    <tr>
      <th>444735.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>0.002894</td>
    </tr>
    <tr>
      <th>444745.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>0.002964</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /></section>
<section id="create-a-blockmodel">
<h2>Create a BlockModel<a class="headerlink" href="#create-a-blockmodel" title="Link to this heading"></a></h2>
<p>The <cite>BlockModel</cite> class is a subclass of <cite>MassComposition</cite> and inherits all its attributes and methods.
The block model plotted below is regular, that is, it has a record for every block in the model.  Blocks
are the same size and adjacent to each other.  The block model is created from a DataFrame that has columns
for the x, y, z coordinates and the copper percentage.</p>
<p>We need to assign a dry mass (DMT) to the block model to conform to the underlying <cite>MassComposition</cite> class.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">bm</span><span class="p">:</span> <span class="n">BlockModel</span> <span class="o">=</span> <span class="n">BlockModel</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;CU_pct&#39;</span><span class="p">:</span> <span class="s1">&#39;Cu&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;DMT&#39;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">}),</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;block_model&#39;</span><span class="p">,</span> <span class="n">moisture_in_scope</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">bm</span><span class="o">.</span><span class="n">_mass_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bm</span><span class="o">.</span><span class="n">is_irregular</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bm</span><span class="o">.</span><span class="n">common_block_size</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>False
(np.float64(10.0), np.float64(10.0), np.float64(10.0))
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">bm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>DMT</th>
      <th>Cu</th>
    </tr>
    <tr>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>444705.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>2000</td>
      <td>0.002696</td>
    </tr>
    <tr>
      <th>444715.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>2000</td>
      <td>0.002760</td>
    </tr>
    <tr>
      <th>444725.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>2000</td>
      <td>0.002826</td>
    </tr>
    <tr>
      <th>444735.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>2000</td>
      <td>0.002894</td>
    </tr>
    <tr>
      <th>444745.0</th>
      <th>492805.0</th>
      <th>2335.0</th>
      <td>2000</td>
      <td>0.002964</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /></section>
<section id="plot-the-block-model">
<h2>Plot the block model<a class="headerlink" href="#plot-the-block-model" title="Link to this heading"></a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">bm</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Cu&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">auto_close</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../../_images/sphx_glr_02_load_block_model_001.png" srcset="../../../_images/sphx_glr_02_load_block_model_001.png" alt="02 load block model" class = "sphx-glr-single-img"/></section>
<section id="filter-the-data">
<h2>Filter the data<a class="headerlink" href="#filter-the-data" title="Link to this heading"></a></h2>
<p>When a dataframe that represents a regular block model (a record for every block) is filtered, the resulting
block model cannot be regular anymore. This is because the filtering operation may remove blocks that are
adjacent to each other, resulting in a block model that is irregular.  This example demonstrates this behavior.
The plot below is generated from a filtered block model that was originally regular.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CU_pct &gt; 0.132&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">bm2</span><span class="p">:</span> <span class="n">BlockModel</span> <span class="o">=</span> <span class="n">BlockModel</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_filtered</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;CU_pct&#39;</span><span class="p">:</span> <span class="s1">&#39;Cu&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;DMT&#39;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">}),</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;block_model&#39;</span><span class="p">,</span> <span class="n">moisture_in_scope</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">bm2</span><span class="o">.</span><span class="n">_mass_data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>(766492, 2)
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">bm2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Cu&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">auto_close</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../../_images/sphx_glr_02_load_block_model_002.png" srcset="../../../_images/sphx_glr_02_load_block_model_002.png" alt="02 load block model" class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 3.062 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-examples-04-block-model-02-load-block-model-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/c25094145cd7f398f1ffc5fca139f5bc/02_load_block_model.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">02_load_block_model.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/105e75612b4d9ca6388a18c9d4f8c552/02_load_block_model.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">02_load_block_model.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01_consuming_omf.html" class="btn btn-neutral float-left" title="Consuming OMF" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../05_mass_balance/01_mass_balance.html" class="btn btn-neutral float-right" title="Mass Balance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Greg Elphick.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>